# How to update the test fixtures

The tests are run against a git repo fixture based on _./testdata/fixtures/git-repo/.
This repo fixture and the associated _./commit-hashes.go_ file containing named
constants for the hashes of the commits that are tested were generated by script
_./testutils/commit-hashes.go_.

To make changes to _git-repo/_, edit the _gen-repo.bash_ script accordingly and
re-run it to generate new fixtures in the _./testsupport/_ directory, then replace
the current fixtures with the new ones:

```shell
# Edit ./testsupport/gen-repo.bash file.
# The script can be run from anywhere.
./testsupport/gen-repo.bash
# New fixtures have been created in ./testsupport/
# Move the new fixtures into place.
```
 
There is a convenience script _./testsupport/update-test-fixtures.bash_ that
runs `gen-repo.bash` and moves the new fixtures into place:

```shell
# Edit ./testsupport/gen-repo.bash file.
# The script can be run from anywhere.
./testsupport/update-test-fixtures.bash
# New fixtures were created and moved into place.
```

This convenience script can be run manually or executed via the `//go:generate`
comment added to the tests file.  There is also a `docker compose` service which
can be used to do update the fixtures using a container:

`go generate`:

```shell
go generate index_test.go
```

Docker:

```shell
docker compose up update-index-package-test-fixtures
```
